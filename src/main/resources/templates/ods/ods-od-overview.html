<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="layout :: head('Login')"></head>
<body>
<div class="main-container">
<div th:replace="layout :: nav"></div>

<div class="container pt-5 pb-5 text-justify">

    <div class="row">
        <div class="col-12">
            <h1>The Sustainable Development Goals as a graph</h1>
            <p>TODO: explain what's happening here</p>
            <div id="goalButtonsContainer" class="text-center">
                <button th:each="i : ${#numbers.sequence(1, 17)}"
                        class="wordCloudBtn btn btn-primary" th:value="${i}" th:text="|Goal ${i}|">Goal 1</button>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-12">
            <div id="chartdiv"></div>
        </div>
    </div>

    <div class="row">
        <div class="col-12">
            <p><span>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci, alias amet architecto aspernatur assumenda culpa deserunt dolore enim id itaque iusto labore necessitatibus recusandae rem, velit, voluptatem voluptatibus! Consequuntur, praesentium?</span><span>Aspernatur dignissimos ea esse illo iste iusto, natus voluptatem! Atque doloribus earum maxime nesciunt, quod temporibus. Alias aliquid atque cumque cupiditate deserunt doloribus, ea libero magnam nostrum odit, officiis quo.</span><span>Atque consequuntur distinctio iure minus nesciunt non nulla placeat qui quod rem reprehenderit, ullam velit veritatis voluptas, voluptatibus! Ab accusantium, atque consequatur corporis enim id iure laborum porro quas vitae.</span><span>Alias aliquam architecto, aspernatur commodi consequatur dicta dolores eaque explicabo facere facilis fugiat illum itaque iusto libero minima nesciunt pariatur perspiciatis placeat porro quibusdam quod ratione repellendus rerum sint ullam?</span><span>Commodi dicta dignissimos, dolores eius, id itaque nobis perspiciatis porro quibusdam recusandae rem repellat temporibus voluptatum. Accusantium at cumque dolor dolorem, ea eaque, fugit id, ipsa iure nobis quae tempora.</span></p>
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Error laboriosam odit quae recusandae rerum tempore tenetur unde. Ducimus ea est illo, libero nam nihil quaerat. Asperiores consectetur facere tempora unde.</p>
            <div style="width: 100%; overflow: auto;">
                <div id="result"></div>
            </div>
        </div>
    </div>
</div>

<div th:replace="layout :: main-footer"></div>
</div>
<div th:replace="layout :: scripts"></div>
<!-- CDN -->
<script src="https://www.amcharts.com/lib/4/core.js"></script>
<script src="https://www.amcharts.com/lib/4/charts.js"></script>
<script src="https://www.amcharts.com/lib/4/themes/material.js"></script>
<script src="https://www.amcharts.com/lib/4/lang/de_DE.js"></script>
<script src="https://www.amcharts.com/lib/4/geodata/germanyLow.js"></script>
<script src="https://www.amcharts.com/lib/4/plugins/wordCloud.js"></script>
<script src="https://www.amcharts.com/lib/4/themes/animated.js"></script>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script th:src="@{/assets/d3/d3sparql.js}"></script>
<script th:inline="javascript">
    /*<![CDATA[*/
    var sparqlEndpoint = /*[[${sparqlEndpoint}]]*/ 'default';

    /*]]>*/

    function exec() {
        // var endpoint = d3.select("#endpoint").property("value")
        // var sparql = d3.select("#sparql").property("value")
        var endpoint = sparqlEndpoint;
        var sparql = "select ?name ?label where {\n" +
            "?s a skos:Concept ;\n" +
            "    skos:inScheme ?concept ;\n" +
            "    skos:prefLabel ?name .\n" +
            "?concept rdfs:label ?label .\n" +
            "FILTER regex(str(?concept), \"SDG_Goal\")\n" +
            "} ";
        d3sparql.query(endpoint, sparql, render)
    }
    function render(json) {
        var config = {
            "charge": -200,
            "distance": 65,
            "width": 1110,
            "height": 750,
            "selector": "#result"
        }
        d3sparql.forcegraph(json, config)
    }

    $( document ).ready(function() {

        am4core.ready(function() {

            // Themes begin
            am4core.useTheme(am4themes_animated);
            // Themes end


            var chart = am4core.create("chartdiv", am4plugins_wordCloud.WordCloud);
            var series = chart.series.push(new am4plugins_wordCloud.WordCloudSeries());

            series.accuracy = 4;
            series.step = 15;
            series.rotationThreshold = 0.7;
            series.maxCount = 200;
            series.minWordLength = 2;
            series.labels.template.tooltipText = "{word}: {value}";
            series.fontFamily = "Courier New";
            series.maxFontSize = am4core.percent(30);

            series.text = "loading";

            series.colors = new am4core.ColorSet();
            series.colors.passOptions = {}; // makes it loop

            series.angles = [0,-90];
            series.fontWeight = "700"

            $.getJSON( "/api/sdg/concepts/1", function( data ) {
                var items = [];
                $.each( data, function( key, val ) {
                    items.push( "<li id='" + key + "'>" + val + "</li>" );
                });

                series.text = items[1];
            });

            $(".wordCloudBtn").click(function () {
                series.text = "loading";
                var endpoint = "/api/sdg/concepts/" + $(this).val();
                $.getJSON( endpoint, function( data ) {
                    var items = [];
                    $.each( data, function( key, val ) {
                        items.push( "<li id='" + key + "'>" + val + "</li>" );
                    });

                    series.text = items[1];
                });
            });
        }); // end am4core.ready()

        // Draw d3 sparql graph
        exec();
    });
</script>
</body>
</html>